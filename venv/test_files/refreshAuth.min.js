!function(){"use strict";function e(e){return e||(e=0),new Promise((function(t){return setTimeout(t,e)}))}function t(){return Math.random().toString(36).substring(2)}var n=0,o=0;function r(){var e=(new Date).getTime();return e===n?1e3*e+ ++o:(n=e,o=0,1e3*e)}var i="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);var a={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Promise.resolve()}catch(e){return Promise.reject(e)}},canBeUsed:function(){if(i&&"undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:r},s=function(){function e(e){this.ttl=e,this.set=new Set,this.timeMap=new Map}return e.prototype.has=function(e){return this.set.has(e)},e.prototype.add=function(e){var t=this;this.timeMap.set(e,u()),this.set.add(e),setTimeout((function(){!function(e){var t=u()-e.ttl,n=e.set[Symbol.iterator]();for(;;){var o=n.next().value;if(!o)return;if(!(e.timeMap.get(o)<t))return;e.timeMap.delete(o),e.set.delete(o)}}(t)}),0)},e.prototype.clear=function(){this.set.clear(),this.timeMap.clear()},e}();function u(){return(new Date).getTime()}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var l="messages";function f(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function d(e,t){var n=e.transaction(l).objectStore(l),o=[];return new Promise((function(e){(function(){try{var e=IDBKeyRange.bound(t+1,1/0);return n.openCursor(e)}catch(e){return n.openCursor()}}()).onsuccess=function(n){var r=n.target.result;r?r.value.id<t+1?r.continue(t+1):(o.push(r.value),r.continue()):e(o)}}))}function p(e,t){return function(e,t){var n=(new Date).getTime()-t,o=e.transaction(l).objectStore(l),r=[];return new Promise((function(e){o.openCursor().onsuccess=function(t){var o=t.target.result;if(o){var i=o.value;if(!(i.time<n))return void e(r);r.push(i),o.continue()}else e(r)}}))}(e,t).then((function(t){return Promise.all(t.map((function(t){return function(e,t){var n=e.transaction([l],"readwrite").objectStore(l).delete(t);return new Promise((function(e){n.onsuccess=function(){return e()}}))}(e,t.id)})))}))}function h(t){t.closed||m(t).then((function(){return e(t.options.idb.fallbackInterval)})).then((function(){return h(t)}))}function m(e){return e.closed?Promise.resolve():e.messagesCallback?d(e.db,e.lastCursorId).then((function(t){return t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time})).forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Promise.resolve()})):Promise.resolve()}var v={create:function(e,n){return n=c(n),function(e){var t="pubkey.broadcast-channel-0-"+e,n=f().open(t,1);return n.onupgradeneeded=function(e){e.target.result.createObjectStore(l,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){n.onerror=function(e){return t(e)},n.onsuccess=function(){e(n.result)}}))}(e).then((function(o){var r={closed:!1,lastCursorId:0,channelName:e,options:n,uuid:t(),eMIs:new s(2*n.idb.ttl),writeBlockPromise:Promise.resolve(),messagesCallback:null,readQueuePromises:[],db:o};return o.onclose=function(){r.closed=!0,n.idb.onclose&&n.idb.onclose()},h(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,m(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var o={uuid:t,time:(new Date).getTime(),data:n},r=e.transaction([l],"readwrite");return new Promise((function(e,t){r.oncomplete=function(){return e()},r.onerror=function(e){return t(e)},r.objectStore(l).add(o)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&p(e.db,e.options.idb.ttl)})),e.writeBlockPromise},canBeUsed:function(){return!i&&!!f()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:r};function g(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function w(e){return"pubkey.broadcastChannel-"+e}function y(){if(i)return!1;var e=g();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var b={create:function(e,n){if(n=c(n),!y())throw new Error("BroadcastChannel: localstorage cannot be used");var o=t(),r=new s(n.localstorage.removeTimeout),i={channelName:e,uuid:o,eMIs:r};return i.listener=function(e,t){var n=w(e),o=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",o),o}(e,(function(e){i.messagesCallback&&e.uuid!==o&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<i.messagesCallbackTime||(r.add(e.token),i.messagesCallback(e.data)))})),i},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(n,o){return new Promise((function(r){e().then((function(){var e=w(n.channelName),i={token:t(),time:(new Date).getTime(),data:o,uuid:n.uuid},a=JSON.stringify(i);g().setItem(e,a);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=e,s.newValue=a,window.dispatchEvent(s),r()}))}))},canBeUsed:y,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:r},_=r,k=new Set;var L={create:function(e){var t={name:e,messagesCallback:null};return k.add(t),t},close:function(e){k.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(k).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:_},E=[a,v,b];var C=function(e,t){var n,o,r;this.name=e,this.options=c(t),this.method=function(e){var t=[].concat(e.methods,E).filter(Boolean);if(e.type){if("simulate"===e.type)return L;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||i||(t=t.filter((function(e){return"idb"!==e.type})));var o=t.find((function(e){return e.canBeUsed()}));if(o)return o;throw new Error("No useable method found in "+JSON.stringify(E.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,o=(n=this).method.create(n.name,n.options),(r=o)&&"function"==typeof r.then?(n._prepP=o,o.then((function(e){n._state=e}))):n._state=o};function P(e,t,n){var o={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:Promise.resolve()).then((function(){var t=e.method.postMessage(e._state,o);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function S(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function x(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&S(e)){var t=function(t){e._addEL[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function M(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!S(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}C._pubkey=!0,C.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed");return P(this,"message",e)},postInternal:function(e){return P(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};M(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,x(this,"message",t)):this._onML=null},addEventListener:function(e,t){x(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){M(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){this.closed=!0;var t=this._prepP?this._prepP:Promise.resolve();return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var I="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?{}:{add:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}}},T=new Set,B=!1;function A(){var e=[];return T.forEach((function(t){e.push(t()),T.delete(t)})),Promise.all(e)}var D={add:function(e){if(B||(B=!0,I.add(A)),"function"!=typeof e)throw new Error("Listener is no function");return T.add(e),{remove:function(){return T.delete(e)},run:function(){return T.delete(e),e()}}},runAll:A,removeAll:function(){T.clear()},getSize:function(){return T.size}},N=function(e,n){this._channel=e,this._options=n,this.isLeader=!1,this.isDead=!1,this.token=t(),this._isApl=!1,this._reApply=!1,this._unl=[],this._lstns=[],this._invs=[],this._dpL=function(){},this._dpLC=!1};function O(e,t){var n={context:"leader",action:t,token:e.token};return e._channel.postInternal(n)}N.prototype={applyOnce:function(){var t=this;if(this.isLeader)return Promise.resolve(!1);if(this.isDead)return Promise.resolve(!1);if(this._isApl)return this._reApply=!0,Promise.resolve(!1);this._isApl=!0;var n=!1,o=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&(n=!0),"tell"===e.action&&(n=!0))};return this._channel.addEventListener("internal",o),O(this,"apply").then((function(){return e(t._options.responseTime)})).then((function(){return n?Promise.reject(new Error):O(t,"apply")})).then((function(){return e(t._options.responseTime)})).then((function(){return n?Promise.reject(new Error):O(t)})).then((function(){return function(e){e.isLeader=!0;var t=D.add((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&O(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),O(e,"tell"))};return e._channel.addEventListener("internal",n),e._lstns.push(n),O(e,"tell")}(t)})).then((function(){return!0})).catch((function(){return!1})).then((function(e){return t._channel.removeEventListener("internal",o),t._isApl=!1,!e&&t._reApply?(t._reApply=!1,t.applyOnce()):e}))},awaitLeadership:function(){var e;return this._aLP||(this._aLP=(e=this).isLeader?Promise.resolve():new Promise((function(t){var n=!1;function o(){n||(n=!0,clearInterval(r),e._channel.removeEventListener("internal",i),t(!0))}e.applyOnce().then((function(){e.isLeader&&o()}));var r=setInterval((function(){e.applyOnce().then((function(){e.isLeader&&o()}))}),e._options.fallbackInterval);e._invs.push(r);var i=function(t){"leader"===t.context&&"death"===t.action&&e.applyOnce().then((function(){e.isLeader&&o()}))};e._channel.addEventListener("internal",i),e._lstns.push(i)}))),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;if(!this.isDead)return this.isDead=!0,this._lstns.forEach((function(t){return e._channel.removeEventListener("internal",t)})),this._invs.forEach((function(e){return clearInterval(e)})),this._unl.forEach((function(e){e.remove()})),O(this,"death")}};var F,R,U,j="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$={exports:{}};R=j,U=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(o){return"debug"===o&&(o="log"),typeof console!==t&&("trace"===o&&n?i:void 0!==console[o]?r(console,o):void 0!==console.log?r(console,"log"):e)}function s(t,n){for(var r=0;r<o.length;r++){var i=o[r];this[i]=r<t?e:this.methodFactory(i,t,n)}this.log=this.debug}function u(e,n,o){return function(){typeof console!==t&&(s.call(this,n,o),this[e].apply(this,arguments))}}function c(e,t,n){return a(e)||u.apply(this,arguments)}function l(e,n,r){var i,a=this,u="loglevel";function l(){var e;if(typeof window!==t&&u){try{e=window.localStorage[u]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,o=n.indexOf(encodeURIComponent(u)+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?u+=":"+e:"symbol"==typeof e&&(u=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=r||c,a.getLevel=function(){return i},a.setLevel=function(n,r){if("string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(i=n,!1!==r&&function(e){var n=(o[e]||"silent").toUpperCase();if(typeof window!==t&&u){try{return void(window.localStorage[u]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(u)+"="+n+";"}catch(e){}}}(n),s.call(a,n,e),typeof console===t&&n<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){l()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=l();null==f&&(f=null==n?"WARN":n),a.setLevel(f,!1)}var f=new l,d={};f.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new l(e,f.getLevel(),f.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=p),f},f.getLoggers=function(){return d},f.default=f,f},(F=$).exports?F.exports=U():R.log=U();var W=$.exports;const J=e=>{let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},z=e=>new Promise((t=>setTimeout(t,e))),G="access-expire-date",V=window.authConfig.endpointUrl,K=e=>{W.debug(`remove ${e} cookie`),document.cookie=e+"=; Max-Age=-99999999;"},Q=e=>Math.floor(e/1e3),Y=e=>1e3*e,q=e=>Q(Date.now())>=e,H=async e=>{await new Promise((t=>{setTimeout((async()=>{try{const n=await(e=V,W.debug("call refresh endpoint"),fetch(e,{credentials:"include",method:"post"}));t(n)}catch{t(!1)}var e}),e)}))},X=async()=>{W.debug("start refresh flow");let e=Number(J(G));if(!e)return W.debug("token expiration date is null"),W.debug("exit refresh flow"),!1;if(q(e)&&(W.debug("token is expired, try to refresh now"),await H(Y(0)),e=Number(J(G)),!e||q(e)))return W.debug("failed to refresh token, exit flow"),K(G),K("user-auth"),!1;const t=Math.max(e-Q(Date.now())-60,0);W.debug(`should refresh token in ${t} sec`),await H(Y(t)),W.debug("sleep for 30 sec"),await z(Y(30)),await X()},Z=async()=>{W.debug("start refresh script"),await(async(e,t=60,n)=>{let o;W.debug(`wait for ${e} cookie`);do{await z(t),o=J(e)}while(!n(o));return W.debug(`got ${e} cookie`),o})(G,30,(e=>!isNaN(Number(e)))),await X(),W.debug("flow exited"),W.debug("sleep for 60 sec"),await z(Y(60)),await Z()};var ee={exports:{}};!function(e){!function(t,n){e.exports?e.exports=n():t.prefix=n(t)}(j,(function(e){var t,n,o={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},r={},i={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,n){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var i=e.methodFactory,a=e.name||"",s=r[a]||r[""]||o;return r[a]||(e.methodFactory=function(e,t,n){var o=i(e,t,n),s=r[n]||r[""],u=-1!==s.template.indexOf("%t"),c=-1!==s.template.indexOf("%l"),l=-1!==s.template.indexOf("%n");return function(){for(var t="",i=arguments.length,f=Array(i),d=0;d<i;d++)f[d]=arguments[d];if(a||!r[n]){var p=s.timestampFormatter(new Date),h=s.levelFormatter(e),m=s.nameFormatter(n);s.format?t+=s.format(h,m,p):(t+=s.template,u&&(t=t.replace(/%t/,p)),c&&(t=t.replace(/%l/,h)),l&&(t=t.replace(/%n/,m))),f.length&&"string"==typeof f[0]?f[0]=t+" "+f[0]:f.unshift(t)}o.apply(void 0,f)}}),(n=n||{}).template&&(n.format=void 0),r[a]=function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(t in arguments[n])Object.prototype.hasOwnProperty.call(arguments[n],t)&&(e[t]=arguments[n][t]);return e}({},s,n),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(n=e.prefix,i.noConflict=function(){return e.prefix===i&&(e.prefix=n),i}),i}))}(ee);var te=ee.exports;te.reg(W),te.apply(W,{format:(e,t,n)=>`[${n}] ${e.toUpperCase()} ${t}:`}),W.enableAll();(function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){return e||(e={}),(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3),e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options)),e}(t,e);var n=new N(e,t);return e._befC.push((function(){return n.die()})),e._leaderElector=n,n})(new C("auth-refresh",{webWorkerSupport:!1})).awaitLeadership().then(Z)}();
